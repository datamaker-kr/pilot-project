{% extends 'base.html' %}

{% block title %}enroll.html{% endblock %}

{% block snack-enroll-extra-classes %}active{% endblock %}

{% block content %}
    <h5 class="my-3 border-bottom pb-2">원하시는 간식을 신청해주세요^^</h5>
    <form id="enroll-form" method="post" class="post-form my-3" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="button" value="등록" class="btn btn-info" onclick="enroll()"/>
    </form>
{% endblock %}

{% block extra-script %}
    <script>
        if(localStorage.getItem("snack_username")==null) {
            alert("로그인이 필요합니다.");
            location.replace("/accounts/login/");
        }
        function enroll() {
            var formData = new FormData($('#enroll-form')[0]);
            formData.append("image", $('[name="image"]')[0].files[0]);
            $.ajax({
                url: "/api/snack/",
                type: "POST",
                headers: {
                    "Authorization": "Token "+token,
                },
                enctype: "multipart/form-data",
                data: formData,
                processData: false,
                contentType: false,
            }).done(function(res){
                window.location.replace('/');
            }).fail(function(request, status, error){
                alert(request.responseText);
            })
        };
    </script>
{% endblock %}